<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>R on kenjisato.jp</title>
    <link>/www.kenjisato.jp/en/tags/r/index.xml</link>
    <description>Recent content in R on kenjisato.jp</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="/www.kenjisato.jp/en/tags/r/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Cross Referenceable Equation with Preview in RMarkdown</title>
      <link>/www.kenjisato.jp/en/post/2017/02/cross-referenceable-equation-with-preview-in-rmarkdown/</link>
      <pubDate>Sun, 12 Feb 2017 00:00:00 +0000</pubDate>
      
      <guid>/www.kenjisato.jp/en/post/2017/02/cross-referenceable-equation-with-preview-in-rmarkdown/</guid>
      <description>

&lt;h2 id=&#34;cross-referenceable-math-equation-in-rmarkdown&#34;&gt;Cross-referenceable math equation in RMarkdown&lt;/h2&gt;

&lt;p&gt;You can cross-reference equations in Rmarkdown if you set output to
&lt;code&gt;bookdown::pdf_document2&lt;/code&gt; and write equations within
&lt;code&gt;\begin{align} ~ \end{align}&lt;/code&gt; or &lt;code&gt;\begin{equation} ~ \end{equation}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To make a tag, put &lt;code&gt;(\#eq:label_name)&lt;/code&gt; inside a math environment. The equation
can be cross-referenced by  &lt;code&gt;\ï¼ ref(eq:label_name)&lt;/code&gt;. See &lt;a href=&#34;http://stackoverflow.com/a/38884378/1877682&#34;&gt;this stackoverflow answer by Yihui Xie&lt;/a&gt; and
&lt;a href=&#34;https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html#equations&#34;&gt;the related section of his bookdown book&lt;/a&gt; for more detail.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;\begin{equation*} ~ \end{equation*}&lt;/code&gt; also produces an equation without number.&lt;/p&gt;

&lt;h2 id=&#34;drawback&#34;&gt;Drawback&lt;/h2&gt;

&lt;p&gt;A drawback of using &lt;code&gt;\begin{align} ~ \end{align}&lt;/code&gt; or the like is that
RStudio doesn&amp;rsquo;t support math preview for them (yet). You must embrace
the whole math environment with &lt;code&gt;$$&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;www.kenjisato.jp/assets/images/posts/2017-02-11-math.png&#34; alt=&#34;math preview&#34; /&gt;&lt;/p&gt;

&lt;p&gt;The former looks nicer but causes the &amp;ldquo;Bad math delimiter&amp;rdquo; error at the time
of tex compilation.&lt;/p&gt;

&lt;h2 id=&#34;workaround&#34;&gt;Workaround&lt;/h2&gt;

&lt;h4 id=&#34;step-1&#34;&gt;Step 1&lt;/h4&gt;

&lt;p&gt;Put the following code snippet in .Rprofile file of the project.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;.beginMath = c(
  &amp;quot;\\begin{equation}&amp;quot;,
  &amp;quot;\\begin{equation*}&amp;quot;,
  &amp;quot;\\begin{align}&amp;quot;,
  &amp;quot;\\begin{align*}&amp;quot;
)

.endMath = c(
  &amp;quot;\\end{equation}&amp;quot;,
  &amp;quot;\\end{equation*}&amp;quot;,
  &amp;quot;\\end{align}&amp;quot;,
  &amp;quot;\\end{align*}&amp;quot;
)

.render_for_tex = function(input, ...){
  output_file = gsub(&amp;quot;\\.[R|r]md$&amp;quot;, &amp;quot;.tex&amp;quot;, input)
  lines = readLines(input, encoding = &amp;quot;UTF-8&amp;quot;);

  for (i in seq_along(lines)) {
    # Remove $$ before \begin{equation} or the like.
    if (stringr::str_trim(lines[i]) == &amp;quot;$$&amp;quot;) {
      if (any(startsWith(lines[i + 1], .beginMath))) {
        lines[i] = &amp;quot;&amp;quot;
      } else if (any(endsWith(lines[i - 1], .endMath))) {
        lines[i] = &amp;quot;&amp;quot;
      }
    }
  }
  writeLines(lines,&amp;quot;temp.Rmd&amp;quot;); on.exit(unlink(&#39;temp.Rmd&#39;))
  rmarkdown::render(&amp;quot;temp.Rmd&amp;quot;, output_file = output_file)
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;step-2&#34;&gt;Step 2&lt;/h4&gt;

&lt;p&gt;Add &lt;code&gt;knit: .render_for_math&lt;/code&gt; to the YAML header of your Rmd file.
Then the Knit button of RStudio is overwritten with the custom renderer
with preprocessing defined in .Rprofile.&lt;/p&gt;

&lt;p&gt;The YAML fromtmatter looks like&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;---
title: title
author: author
output:
  bookdown::pdf_document2:
    toc: false
    fig_caption: yes
knit: .render_for_tex
---
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;example&#34;&gt;Example&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;www.kenjisato.jp/assets/pdf/math_workaround_pdf.pdf&#34;&gt;This PDF file&lt;/a&gt; is generated by &lt;a href=&#34;https://gist.github.com/kenjisato/38a646042ab6d64788c24c51cf36aae7&#34;&gt;the Rmd file and .Rprofile stored here&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>